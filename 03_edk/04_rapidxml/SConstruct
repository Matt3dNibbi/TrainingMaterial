import os, sys


#---------------------------------------------------------
extEnv = Environment()

if sys.platform == 'win32':
  buildOS = 'Windows'
elif sys.platform == 'linux2':
  buildOS = 'Linux'

buildArch = 'x86_64'

extEnv.Append(CPPPATH = [os.path.join(os.environ['FABRIC_EDK_DIR'], 'include')])
extEnv.Append(CPPPATH = ['rapidxml-1.13']) 

extFiles = []
extFiles += Glob('*.kl')
extFiles += Glob('*.json')

edkLibrary = extEnv.SharedLibrary('RapidXml'+'-'+buildOS+'-'+buildArch, Glob('RapidXml*.cpp'))
extFiles += edkLibrary

extAlias = extEnv.Alias('ext', extFiles)

#---------------------------------------------------------

testEnv = Environment()

testEnv.Append(CPPPATH = [os.path.join(os.environ['FABRIC_DIR'], 'include')])
testEnv.Append(LIBPATH = [os.path.join(os.environ['FABRIC_DIR'], 'lib')])
testEnv.Append(CPPDEFINES = ['FEC_SHARED', 'FECS_SHARED'])

# Fabric Engine libraries
testEnv.Append(LIBS = ['FabricSplice-1.15', 'FabricCore-1.15'])

# standard libraries
if buildOS == 'Windows':
  testEnv.Append(LIBS = ['user32', 'advapi32', 'gdi32', 'shell32', 'ws2_32', 'Opengl32', 'glu32'])
else:
  testEnv.Append(LIBS = ['X11', 'GLU', 'GL', 'dl', 'pthread'])

testProgram = testEnv.Program('test', Glob('test.cpp'))
testAlias = testEnv.Alias('test', testProgram)

#---------------------------------------------------------

Alias('all', [extAlias, testAlias])
